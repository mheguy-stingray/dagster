version: "3.7"

services:
  test-mysql-db:
    image: mysql:8
    command: mysqld --default-authentication-plugin=mysql_native_password
    container_name: test-mysql-db
    ports:
      - "3306:3306"
    environment:
      MYSQL_ROOT_PASSWORD: "test"
      MYSQL_PASSWORD: "test"
      MYSQL_USER: "test"
      MYSQL_DATABASE: "test"
    networks:
      - mysql

  test-mysql-db-pinned:
    image: mysql:8.0.21
    command: mysqld --default-authentication-plugin=mysql_native_password --sql-require-primary-key=ON
    container_name: test-mysql-db-pinned
    ports:
      - "3307:3307"
    environment:
      MYSQL_ROOT_PASSWORD: "test"
      MYSQL_PASSWORD: "test"
      MYSQL_USER: "test"
      MYSQL_DATABASE: "test"
      MYSQL_TCP_PORT: 3307
    expose:
      - 3307
    networks:
      - mysqlbackcompat

  test-mysql-db-pinned-backcompat:
    image: mysql:8.0.21
    command: mysqld --default-authentication-plugin=mysql_native_password
    container_name: test-mysql-db-pinned-backcompat
    ports:
      - "3308:3308"
    environment:
      MYSQL_ROOT_PASSWORD: "test"
      MYSQL_PASSWORD: "test"
      MYSQL_USER: "test"
      MYSQL_DATABASE: "test"
      MYSQL_TCP_PORT: 3308
    expose:
      - 3308
    networks:
      - mysqlbackcompat

networks:
  mysql:
    driver: bridge
    name: mysql
  mysqlbackcompat:
    driver: bridge
    name: mysqlbackcompat
